[{"content":" 警示：水平有限，以下内容均有可能存在错漏！ 如有发现，请下方留言或提交 pull request，感谢您的贡献！ 仅供参考的示例； 没有通用的模板。 了解统计更重要； 照搬后果请自负。 本分析以多物种、双因素为例，展示常用的方差分析的 R 实现。当然，通过少量的调整，也可以向下兼容：单物种、单因素；也可能向上兼容：三因素至多因素。例如，“三因素”可假想成“双因素中的一个因素再包含一双因素”，一些双因素的函数通过自我函数嵌套，可实现扩展。 一个分析需求，常常对应着多种 R 实现，本示例列举了常用的几种。有些采用 R 中常用的批量（如循环、重复、分组等）计算方式，尽可能地避免使用大量重复代码；有些方法为了篇幅的简洁，仅以局部单一情况做演示，但是它们都可以用类似的方式实现批量计算，参照上下文自行调整即可。 本示例原文档下载地址：https://github.com/pftz/pftz/blob/master/content/post/2021-07-23-r-anova/index.Rmd 示例数据 x，自变量，解释变量，预测变量，独立变量，IV (Independent variables) y，因变量，响应变量，结果变量，依赖变量，DV (Dependent variables) 构建示例用数据 # 构建一个伪造的示例数据框 set.seed(110) df F) ## drought 2 0.6133 0.30664 93.43 4.83e-08 *** ## Residuals 12 0.0394 0.00328 ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 # 方法二：回归方法 # 默认第一个水平（fertilizer: Control）为参照 levels(df_aa_npk$drought) ## [1] \"D25\" \"D50\" \"D75\" lm_b1dry F) ## drought 2 0.61328 0.306639 93.427 4.829e-08 *** ## Residuals 12 0.03939 0.003282 ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 # 方法三：car::Anova library(car) Anova(lm_b1dry) ## Anova Table (Type II tests) ## ## Response: biomass ## Sum Sq Df F value Pr(F) ## drought 0.61328 2 93.427 4.829e-08 *** ## Residuals 0.03939 12 ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 手算方差分析平方和（番外） 组间平方和 Sum of Squares due to Treatment (SSTR) the treatment sum of squares the sum of squares for treatments \\[ \\begin{align} SSTR \u0026 = \\sum_{i=1}^k\\sum_{j=1}^n(\\bar x_i-\\bar x')^2 \\\\ \u0026 = \\Sigma_{i=1}^kn_i(\\bar x_i-\\bar x')^2 \\\\ \u0026 = \\sum_{i}n_i(\\overline{Y}_i-\\overline{Y}_{total})^2 \\end{align} \\] 组内平方和 the Sum of Squares due to Error (SSE) the error sum of squares the sum of squares of the residual error \\[ \\begin{align} SSE \u0026 = \\sum_{i=1}^k\\sum_{j=1}^n(x_ij-\\bar x_i)^2 \\\\ \u0026 = \\sum_{i}\\sum_{j}(Y_{ij}-\\overline{Y}_i)^2 \\end{align} \\] #- 组间平方和 within groups，处理误差 # 5 个重复 sum((tapply(df_aa_npk$biomass, df_aa_npk$drought, mean) - mean(df_aa_npk$biomass))^2)*5 ## [1] 0.6132778 #- 组内平方和 between groups，随机误差 # 4 个物种 sum((tapply(df_aa_npk$biomass,df_aa_npk$drought,var)))*4 ## [1] 0.0393857 多因素 本示例为重复试验、非重复测量。 分析不同物种、不同种植密度、不同施肥处理对产量的影响，即把物种也视为一种处理（不推荐）： # 不含交互项 aov_b2main F) ## drought 2 0.83730 0.41865 187.567 2.234e-15 *** ## fertilizer 1 0.02441 0.02441 10.935 0.002963 ** ## drought:fertilizer 2 0.07114 0.03557 15.936 3.947e-05 *** ## Residuals 24 0.05357 0.00223 ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ## ## $BB ## Analysis of Variance Table ## ## Response: biomass ## Df Sum Sq Mean Sq F value Pr(F) ## drought 2 0.66154 0.33077 136.2385 7.919e-14 *** ## fertilizer 1 0.01243 0.01243 5.1195 0.03299 * ## drought:fertilizer 2 0.02671 0.01336 5.5011 0.01080 * ## Residuals 24 0.05827 0.00243 ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ## ## $CC ## Analysis of Variance Table ## ## Response: biomass ## Df Sum Sq Mean Sq F value Pr(F) ## drought 2 0.72532 0.36266 607.291 F) ## drought 2 0.81257 0.40629 478.368 |t|) ## D50 - D25 == 0 0.37255 0.03623 10.28 2000 时 检验方差齐性 Bartlett test Fligner-Killeen test Brown-Forsythe test Levene’s test # 残差分析 par(mfrow = c(2, 2)) plot(lrm_b2mix_sp$AA) Figure 20: 回归检验组图 # 使用隐式循环批量作图 par(mfrow = c(4, 4)) lapply(lrm_b2mix_sp, plot) Figure 21: 回归检验组图 ## $AA ## NULL ## ## $BB ## NULL ## ## $CC ## NULL ## ## $DD ## NULL # 实际值（观测值）与拟合值（预测值） par(mfrow=c(1,1)) plot(lrm_b2mix_sp$AA$fitted.values ~ lrm_b2mix_sp$AA$model$biomass) Figure 22: 拟合效果图 # Q-Q 图 qqplot() # library(car) qqPlot(lrm_b2mix_sp$AA$residuals, main = \"QQ Plot\") lapply(lrm_b2mix_sp, function(x) shapiro.test(resid(x))) # 方差齐性 with(df, by(df, species, function(d) bartlett.test(biomass ~ interaction(drought, fertilizer), d))) # library(car) # 'levene.test()' is defunct. with(df, by(df, species, function(d) leveneTest(biomass ~ drought*fertilizer, d))) fligner.test() HH::hov() # 离群点/异常值 car::outlierTest(lrm_b2mix_sp$AA) ## rstudent unadjusted p-value Bonferroni p ## 61 -5.82263 6.2157e-06 0.00018647 待办 增补/删减内容，使其更完整且专注既定主题 添加方法的利弊比较，以及用于选择的经验法则 增加多个因变量的分析，以及为不同因变量进行批量分析的 R 实现 提取主线，单独打包成自定义函数 优化作图，更符合出版格式 贡献 在本页面下方（Issues）评论/提问/回答 修改或补充内容，包括 R 语句、错别字等，可提交 pull request 参考 R语言实战 R in Action 赖江山 R 课, 广州, 2018. de Micheaux PL, et al. 潘东东, 等译. R 软件教程与统计分析：入门到精通. 2015. 北京：高等教育出版社. William M. Mendenhall, Terry L. Sincich, Nancy S. Boudreau. 2017. Statistics for engineering and the sciences. Chapman and Hall, CRC. UCLA: Data analysis examples Applied Statistics with R: Chapter 12 Analysis of Variance ANOVA in R: A step-by-step guide ","title":"R 方差分析：以多物种、双因素为例","uri":"/post/2021/07/31/r-anova/"},{"content":"所有文章（含笔记、综述、翻译、推荐等）列表：\n2021   2021/07/31 R 方差分析：以多物种、双因素为例   ","title":"归档","uri":"/archives/"},{"content":"FTZ 无中生油子站延续\n 本站如果有切实帮助到你，欢迎给予反馈（评论、提问、赞帖、纠错、补充、内容发布等等皆可）。\n一起分享、共同学习。\n","title":"欢迎","uri":"/about/"}]
